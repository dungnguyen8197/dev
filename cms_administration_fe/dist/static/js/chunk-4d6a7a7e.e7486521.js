(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d6a7a7e"],{"30c6":function(e,t,n){"use strict";n("a088")},"9a43":function(e,t,n){"use strict";n.r(t);var a=n("2909"),o=(n("b0c0"),function(){var e=this,t=e._self._c;return t("el-row",{staticStyle:{margin:"20px"}},[t("el-row",[t("el-col",{attrs:{sm:24}},[t("h3",{staticStyle:{margin:"0",width:"100%",padding:"10px","text-align":"center"}},[e._v(e._s("MÀN CỦA SALE"))])])],1),t("div",{staticClass:"clearfix-20"}),t("el-row",[t("el-col",{attrs:{sm:24}},[t("h4",{staticStyle:{margin:"0",width:"100%",padding:"10px",color:"red","text-align":"center"}},[e._v(e._s("Tổng số tiền: ".concat(e.formatNumber(e.total_money)," VNĐ")))])])],1),t("div",{staticClass:"filter-container"},[t("el-row",[t("el-col",{staticClass:"mb-10"},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v(" Thêm mới ")])],1)],1),t("el-row",{staticClass:"row-search-money"},[t("el-col",{staticClass:"search-money",attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-select",{ref:"SearchAdmin",staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",placeholder:"Nhập tên sale","remote-method":e.onSearchAdmin,loading:e.loadingSearchAdmin},on:{"hook:mounted":function(t){return e.cancelReadOnly(t,"SearchAdmin")},"visible-change":function(t){return e.cancelReadOnly(t,"SearchAdmin")}},model:{value:e.query.admin_id,callback:function(t){e.$set(e.query,"admin_id",t)},expression:"query.admin_id"}},e._l(e.admins,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)]),t("el-col",{staticClass:"search-money",attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",remote:"","reserve-keyword":"","multiple-limit":1,placeholder:"Tìm kiếm theo trạng thái"},model:{value:e.query.is_clear,callback:function(t){e.$set(e.query,"is_clear",t)},expression:"query.is_clear"}},e._l(e.statusList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),t("el-col",{staticClass:"search-money",attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"","multiple-limit":1,placeholder:"Số tài khoản"},model:{value:e.query.bank_account_number,callback:function(t){e.$set(e.query,"bank_account_number",t)},expression:"query.bank_account_number"}},e._l(e.bankAccountList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),t("el-col",{staticClass:"search-money",attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-input",{attrs:{placeholder:"Nhập mã booking"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter.apply(null,arguments)}},model:{value:e.query.code_booking,callback:function(t){e.$set(e.query,"code_booking",t)},expression:"query.code_booking"}})],1)])],1),t("el-row",{staticClass:"row-search-money"},[t("el-col",{staticClass:"search-money",attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-input",{attrs:{placeholder:"Nhập Nội dung CK"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter.apply(null,arguments)}},model:{value:e.query.transfer_content,callback:function(t){e.$set(e.query,"transfer_content",t)},expression:"query.transfer_content"}})],1)]),t("el-col",{staticClass:"search-money",attrs:{span:4}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-input",{attrs:{placeholder:"Nhập số tiền"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter.apply(null,arguments)}},model:{value:e.query.amount_money,callback:function(t){e.$set(e.query,"amount_money",t)},expression:"query.amount_money"}})],1)]),t("el-col",{staticClass:"search-money",attrs:{span:4}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-input",{attrs:{placeholder:"Ghi chú"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter.apply(null,arguments)}},model:{value:e.query.note,callback:function(t){e.$set(e.query,"note",t)},expression:"query.note"}})],1)]),t("el-col",{staticClass:"search-money",attrs:{span:4}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",remote:"","reserve-keyword":"","multiple-limit":1,placeholder:"Nguồn tạo"},model:{value:e.query.source_type,callback:function(t){e.$set(e.query,"source_type",t)},expression:"query.source_type"}},e._l(e.sourceList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),t("el-col",{staticClass:"search-money",attrs:{span:6}},[t("div",{staticClass:"grid-content bg-purple"},[t("el-date-picker",{staticClass:"w-100",attrs:{format:"dd-MM-yyyy HH:mm:ss",type:"datetimerange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1)])],1),t("el-row",[t("el-col",{staticClass:"mr-10 mt-10 filter-search",attrs:{sm:12,md:8}},[t("el-button",{attrs:{icon:"el-icon-refresh",round:""},on:{click:e.onReset}},[e._v("Reset")]),t("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v(" Tìm kiếm ")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-download",loading:e.loadingExportExcel},on:{click:e.handleDownload}},[e._v(" Export excel ")])],1)],1)],1),t("div",{staticClass:"clearfix-10"}),t("el-row",{staticStyle:{"margin-top":"40px"}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingTable,expression:"loadingTable"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{label:"STT",width:"100",align:"center",type:"index",index:e.handleIndexMethod}}),t("el-table-column",{attrs:{label:"Sale xử lý",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.sale?[t("el-tag",[e._v(e._s(n.row.sale.name))]),e.checkAdmin(n.row)&&0===n.row.is_done?t("el-button",{staticStyle:{"margin-top":"5px"},attrs:{loading:e.loadingUnProcess,size:"small",type:"primary"},on:{click:function(t){return e.unConfirmProcess(n.row)}}},[e._v("Nhả xử lý ")]):e._e()]:e._e(),null==n.row.sale&&0===n.row.is_clear?t("el-button",{staticStyle:{"margin-top":"5px"},attrs:{size:"small",type:"primary"},on:{click:function(t){return e.confirmProcess(n.row)}}},[e._v("Nhận xử lý ")]):[t("el-tag",[e._v("Hệ thống")])]]}}])}),t("el-table-column",{attrs:{label:"Nguồn tạo",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[0==n.row.source_type?t("el-tag",{attrs:{type:"success"}},[e._v("Hệ thống tạo")]):t("el-tag",{attrs:{type:"warning"}},[e._v("CMS tạo")])]}}])}),t("el-table-column",{attrs:{label:"TT Clear",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[[1===n.row.is_clear?t("el-tag",{attrs:{type:"success"}},[e._v("Clear")]):t("el-tag",{attrs:{type:"warning"}},[e._v("No")])],[1===n.row.is_system_clear?t("el-tag",{attrs:{type:"success"}},[e._v("Hệ thống Clear")]):e._e()]]}}])}),t("el-table-column",{attrs:{prop:"date_transaction",label:"Ngày",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.date_transaction?e.convertDateTime(t.row.date_transaction):"")+" ")]}}])}),t("el-table-column",{attrs:{prop:"amount_money",label:"Số tiền",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.amount_money?e.formatNumber(t.row.amount_money):"")+" ")]}}])}),t("el-table-column",{attrs:{prop:"bank_account_number",label:"Số tài khoản",align:"center"}}),t("el-table-column",{attrs:{prop:"bank_name",label:"Ngân hàng",align:"center"}}),t("el-table-column",{attrs:{prop:"code_payment",label:"Mã thanh toán",align:"center"}}),t("el-table-column",{attrs:{prop:"trace_code",label:"trace code",align:"center"}}),t("el-table-column",{attrs:{label:"Mã BK",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.booked.length>0?[e._l(Object(a["a"])(n.row.code_booking.split(",")),(function(n){return[t("el-tag",{key:n},[e._v(e._s(n))])]}))]:n.row.code_booking?[e._l(n.row.code_booking.split(","),(function(n){return[t("el-tag",{key:n},[e._v(e._s(n))])]}))]:e._e()]}}])}),t("el-table-column",{attrs:{prop:"note",label:"NOTE",align:"center"}}),t("el-table-column",{attrs:{prop:"transfer_content",label:"Nội dung chuyển khoản",align:"center"}}),t("el-table-column",{attrs:{prop:"admin.name",label:"Admin",align:"center"}}),t("el-table-column",{attrs:{label:"Hành động",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(n){return e.checkAdmin(n.row)?t("section",{staticStyle:{display:"flex","align-items":"center"}},[t("section",{staticClass:"mr-10"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleEdit(n.row)}}},[e._v("Edit")])],1),t("section",[1==n.row.is_done?t("el-tag",{attrs:{type:"success"}},[e._v(" Đã xác nhận ")]):t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.confirmDone(n.row)}}},[e._v("Xác nhận ")])],1)]):e._e()}}],null,!0)})],1),t("el-row",{staticClass:"list-device__footer"},[t("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>e.query.limit,expression:"total > query.limit"}],attrs:{total:e.total,limit:e.query.limit,page:e.query.page},on:{"update:limit":function(t){return e.$set(e.query,"limit",t)},"update:page":function(t){return e.$set(e.query,"page",t)},pagination:e.onGetList}}),t("dialog-edit-history",{attrs:{"show-dialog":e.showDialogUpdateRow,"is-add":e.isAdd,"object-data":e.objectDataEdit},on:{onCloseDialog:e.handleClose}}),t("dialog-confirm-process",{attrs:{"dialog-confirm-process":e.dialogConfirmProcess,"object-data":e.objectData},on:{onCloseDialog:e.handleClose}}),t("el-dialog",{attrs:{title:"Xác nhận xong ",visible:e.dialogConfirmDone,width:"30%",center:""},on:{"update:visible":function(t){e.dialogConfirmDone=t}}},[t("span",[e._v('Bạn có xác nhận đã "DONE" ?')]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogConfirmDone=!1}}},[e._v("Cancel")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleConfirmDone()}}},[e._v("Confirm")])],1)]),t("el-dialog",{attrs:{title:"Xác nhận clear or no ",visible:e.dialogConfirmClear,width:"30%",center:""},on:{"update:visible":function(t){e.dialogConfirmClear=t}}},[t("span",[e._v("Cập nhật TT clear ( No or Clear ) ?")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.handleConfirmClear(e.clear=0)}}},[e._v("No")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleConfirmClear(e.clear=1)}}},[e._v("Clear")])],1)])],1)],1)],1)}),l=[],i=n("5530"),r=(n("498a"),n("d3b7"),n("d81d"),n("6062"),n("3ca3"),n("ddb0"),n("a15b"),n("333d")),s=n("01bc"),c=n("e0cb"),d=n("c1df"),u=n.n(d),m=n("bcc2"),p=n("2ea5"),h=n("b274"),g=n("5f87"),f=n("60fe"),y=new s["a"],b=new c["a"],_={name:"MoneyInSale",components:{Pagination:r["a"],DialogEditHistory:p["a"],DialogConfirmProcess:h["a"]},data:function(){return{loadingTable:!1,tableData:[],query:{limit:10,page:1,type:2,is_sale:!0},total:0,loadingExportExcel:!1,statusList:[{label:"no",value:0},{label:"clear",value:1}],sourceList:[{label:"Hệ thống tạo",value:0},{label:"CMS tạo",value:1}],bankAccountList:f["g"],total_money:0,dialogUpdateNote:!1,objectData:{},objectDataEdit:{},showDialogUpdateRow:!1,adminData:[],loadingSearchAdmin:!1,dateRange:"",dialogConfirmDone:!1,dialogConfirmClear:!1,dialogConfirmProcess:!1,body:{},request:{},timer:"",isAdd:!0,admins:[],loadingUnProcess:!1}},computed:{datePickerOptions:function(){var e=this;return{disabledDate:function(t){var n=new Date(e.query.start_date);return n.setDate(n.getDate()+1),t.getTime()<n.getTime()}}}},watch:{dateRange:function(e){e?(this.query.start_date=u()(e[0]).unix(),this.query.end_date=u()(e[1]).unix()):(this.query.start_date="",this.query.end_date="")}},created:function(){this.onGetList(),this.timer=setInterval(this.onGetList,2e4)},beforeDestroy:function(){clearInterval(this.timer)},methods:{checkAdmin:function(e){var t,n;return(null===e||void 0===e||null===(t=e.sale)||void 0===t?void 0:t.id)===(null===(n=Object(g["a"])())||void 0===n?void 0:n.id)},onGetList:function(){var e=this;this.loadingTable=!0,y.moneyInList(this.query).then((function(t){e.loadingTable=!1;var n=t.error_code,a=t.data;0===n?(e.tableData=a.data,e.total=a.total,e.total_money=a.total_money):e.$message.error("Lỗi hệ thống, vui lòng liên hệ bộ phận kỹ thuật")})).catch((function(t){e.loadingTable=!1}))},onSearchAdmin:function(e){var t=this;this.loadingSearchAdmin=!0,b.searchAdmin({keyword_admin:e.trim()}).then((function(e){t.loadingSearchAdmin=!1;var n=e.error_code,a=e.data;0===n&&(t.admins=a)}))},handleFilter:function(){this.query.page=1,this.loadingTable=!0,this.onGetList()},onReset:function(){this.query=Object.assign({},{page:1,limit:10,type:2}),this.dateRange="",this.onGetList()},handleDownload:function(){var e=this;this.loadingExportExcel=!0;var t=Object.assign({},this.query);delete t.limit,delete t.page,y.exportExcel(t).then((function(t){var o=t.error_code,l=t.data;0===o?(e.dataExcel=l.data,e.dataExcel.map((function(e,t){if(e.index=t+1,e.sale){var n=e.sale.name;e.sale_name=n}if(e.admin){var o=e.admin.name;e.admin_name=o}if(e.booked){var l=Object(a["a"])(new Set(e.booked.map((function(e){return e.code_booking}))));e.booked=l.join(),console.log(e.booked)}e.source_name=0===e.source_type?"Hệ thống tạo":"CMS tạo",e.clear=0===e.is_clear?"No":"Clear"})),Promise.all([n.e("chunk-6e83591c"),n.e("chunk-5164a781"),n.e("chunk-39e3bbe0"),n.e("chunk-f440bdbc")]).then(n.bind(null,"4bf8")).then((function(t){var n=["STT","Sale xử lý","Nguồn tạo","TT clear","Ngày","Số tiền","Số tài khoản","Ngân hàng","Mã thanh toán","trace code","Mã BK","Note","Nội dung chuyển khoản","Admin"],a=["index","sale_name","source_name","clear","date_transaction","amount_money","bank_account_number","bank_name","code_payment","trace_code","booked","note","transfer_content","admin_name"],o=e.dataExcel;o=e.formatJson(a,o),t.export_json_to_excel({header:n,data:o,filename:"TopUpCms"})}))):e.$message.error("Lỗi hệ thống, vui lòng liên hệ bộ phận kỹ thuật")})).catch((function(t){e.loadingExportExcel=!1})).finally((function(t){e.loadingExportExcel=!1}))},formatJson:function(e,t){return t.map((function(t){return e.map((function(e){return t[e]}))}))},handleIndexMethod:function(e){return 1===this.query.page?this.query.page+e:(this.query.page-1)*this.query.limit+e+1},handleEditNote:function(e){this.dialogUpdateNote=!0,this.objectData=Object.assign({},e)},handleClose:function(){this.dialogUpdateNote=!1,this.showDialogUpdateRow=!1,this.dialogConfirmProcess=!1,this.onGetList()},handleEdit:function(e){this.isAdd=!1,this.showDialogUpdateRow=!0,this.objectDataEdit=Object.assign({},Object(i["a"])(Object(i["a"])({},e),{},{is_sale:!0}))},handleAdd:function(){this.isAdd=!0,this.showDialogUpdateRow=!0,this.objectDataEdit={}},confirmDone:function(e){this.dialogConfirmDone=!0,this.query.id=e.id,this.request.time_done=u()().format("YYYY-MM-DD HH:mm:ss")},handleConfirmDone:function(){var e=this;this.dialogConfirmDone=!0;var t={is_done:1,time_done:this.request};y.confirmDone(t,this.query.id).then((function(t){e.dialogConfirmDone=!1;var n=t.error_code,a=t.error_msg;0===n?(e.$message.success(a),e.onGetList()):e.$message.error(a)})).catch((function(t){e.dialogConfirmDone=!1}))},confirmClear:function(e){this.dialogConfirmClear=!0,this.query.id=e.id,this.body.is_clear=e.is_clear},handleConfirmClear:function(e){},confirmProcess:function(e){this.dialogConfirmProcess=!0,e.baseUrl=this.baseUrl,this.objectData=Object.assign({},e)},unConfirmProcess:function(e){var t=this;this.loadingUnProcess=!0,y.confirmUnProcess(e.id).then((function(e){var n=e.error_code,a=e.error_msg;t.loadingUnProcess=!1,0===n?(t.$message.success(a),t.onGetList()):t.$message.error(a)})).catch((function(e){t.loadingUnProcess=!1}))},cancelReadOnly:function(e,t){var n=this;this.$nextTick((function(){if(!e){var a=n.$refs[t],o=a.$el.querySelector(".el-input__inner");o.removeAttribute("readonly")}}))},formatNumber:m["k"],convertDateTime:m["b"]}},v=_,k=(n("30c6"),n("2877")),C=Object(k["a"])(v,o,l,!1,null,"237b4c79",null);t["default"]=C.exports},a088:function(e,t,n){}}]);