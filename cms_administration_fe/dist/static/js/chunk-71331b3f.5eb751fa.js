(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71331b3f"],{"16dd":function(t,e,i){"use strict";i("f677")},6391:function(t,e,i){"use strict";i.r(e);i("b0c0");var n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"debt-page"}},[e("div",{staticStyle:{width:"100",display:"flex","justify-content":"space-between"}},[e("div",[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("p",{staticStyle:{"margin-right":"15px","margin-bottom":"0px"},on:{click:t.onBack}},[e("i",{staticClass:"el-icon-back"})]),e("h3",{staticStyle:{margin:"0px"}},[t._v("Quản lý công nợ( "+t._s(t.sub_title)+")")])]),t.isOverdueDebt?e("h4",{staticStyle:{color:"red"}},[t._v(t._s(t.stringOverdueDebt))]):t._e()]),e("div",{staticStyle:{display:"flex","align-items":"center"}},[t.is_export?e("el-button",{staticStyle:{height:"40px"},attrs:{type:"primary",icon:"el-icon-download"},on:{click:t.handleExportExcel}},[t._v("Xuất excel")]):t._e(),e("el-button",{staticStyle:{float:"right",height:"40px"},attrs:{icon:"el-icon-refresh",loading:t.loading},on:{click:t.resetFilter}},[t._v("Làm mới")])],1)]),e("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{type:"text",rows:2,placeholder:"Nhập tìm kiếm"},model:{value:t.listQuery.q,callback:function(e){t.$set(t.listQuery,"q",e)},expression:"listQuery.q"}},[e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e("el-select",{staticStyle:{"margin-right":"10px",width:"220px"},attrs:{placeholder:"Phương thức tìm kiếm"},model:{value:t.listQuery.type_search,callback:function(e){t.$set(t.listQuery,"type_search",e)},expression:"listQuery.type_search"}},t._l(t.searchOption,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.getDebt}},[t._v("Tìm kiếm")]),e("el-select",{staticStyle:{width:"170px","margin-right":"10px"},attrs:{placeholder:"Trạng thái"},model:{value:t.filterState,callback:function(e){t.filterState=e},expression:"filterState"}},t._l(t.stateOption,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"Đến","start-placeholder":"Ngày bắt đầu","end-placeholder":"Ngày kết thúc"},on:{change:t.handleChangeDateRange},model:{value:t.dateRangeDebt,callback:function(e){t.dateRangeDebt=e},expression:"dateRangeDebt"}})],1),e("div",{staticStyle:{"margin-top":"20px"},attrs:{id:"brand-table-id"}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,align:"center",border:""}},[e("el-table-column",{attrs:{prop:"code",label:"Mã NCC",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-link",{staticStyle:{color:"#1890ff"},attrs:{underline:!1,href:"#/supplier-info?shop_id="+i.row.shop_id}},[t._v(t._s(i.row.code))])]}}])}),e("el-table-column",{attrs:{prop:"shop_name",label:"Tên nhà cung cấp",align:"center"}}),e("el-table-column",{attrs:{prop:"debt_beginning_format",label:"CNĐK tháng T-1",align:"center"}}),e("el-table-column",{attrs:{prop:"debt_end_priod_format",label:"CNCK tháng T-1",align:"center"}}),e("el-table-column",{attrs:{prop:"debt_arises_format",label:"CNPS tháng T",align:"center"}}),e("el-table-column",{attrs:{prop:"money_paid_format",label:"Số tiền đã thanh toán",align:"center"}}),e("el-table-column",{attrs:{prop:"remaining_money_format",label:"Số tiền còn lại",align:"center"}}),e("el-table-column",{attrs:{prop:"date_payment",label:"Ngày thanh toán",align:"center"}}),e("el-table-column",{attrs:{prop:"status_paid",label:"Trạng thái",align:"center"},scopedSlots:t._u([{key:"default",fn:function(i){return[0===i.row.status_paid?e("p",{staticStyle:{color:"red","font-size":"14px"}},[t._v(t._s(i.row.state))]):t._e(),1===i.row.status_paid?e("p",{staticStyle:{color:"#0C8C56","font-size":"14px"}},[t._v(t._s(i.row.state))]):t._e()]}}])})],1),e("el-row",[e("pagination",{attrs:{total:t.total,limit:t.listQuery.limit,page:t.listQuery.page},on:{"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},"update:page":function(e){return t.$set(t.listQuery,"page",e)},pagination:t.getDebt}})],1)],1)])},a=[],r=i("c7eb"),l=i("1da1"),o=(i("99af"),i("ac1f"),i("5319"),i("e9c4"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("88a7"),i("271a"),i("5494"),i("9911"),i("159b"),i("045c")),s=i("333d"),c=i("bcc2"),u=i("5f87"),d=i("fa7d"),p=new o["a"],h={name:"DebtPage",components:{Pagination:s["a"]},data:function(){var t=new Date;return{is_view:0,is_edit:0,is_delete:0,is_export:0,is_write:0,dateRangeDebt:"",loading:!1,countOverdueDebt:0,isOverdueDebt:!1,tableData:[],sub_title:"Tháng ".concat(t.getMonth()+1,"/ ").concat(t.getFullYear()),total:0,listQuery:{page:1,limit:10,type_search:2,q:""},filterState:0,stateOption:[{id:0,name:"Trạng thái (Tất cả)"},{id:2,name:"Đã thanh toán"},{id:1,name:"Chưa thanh toán"}],searchOption:[{id:2,name:"Tìm theo tên nhà cung cấp"},{id:1,name:"Tìm theo mã nhà cung cấp"}]}},computed:{stringOverdueDebt:function(){return"Bạn có ".concat(this.countOverdueDebt," công nợ sắp đến hạn thanh toán")}},watch:{filterState:{handler:function(){this.listQuery.page=1,this.listQuery.paid=this.filterState,this.getDebt()}},"listQuery.q":{handler:function(){""===this.listQuery.q&&(this.listQuery.page=1,this.getDebt())}}},mounted:function(){this.getCountOverdueDebt(),this.requestListPermissionMenu()},methods:{onBack:function(){window.history.back()},requestListPermissionMenu:function(){var t=this,e=this.$router.history.current.meta.roles,i=e&&e.length?e[0]:0;i=parseInt(i.replace("NCC",""));var n=Object(u["a"])(),a=n.email;Object(d["a"])(a,i,(function(e){if(console.log("............list data 1",JSON.stringify(e)),e){var i=e.is_supper_admin,n=e.is_add,a=e.is_view,r=e.is_edit,l=e.is_delete,o=e.is_export;i=parseInt(i)||0,n=parseInt(n)||1,a=parseInt(a)||1,r=parseInt(r)||1,l=parseInt(l)||1,o=parseInt(o)||1,t.is_delete=i?1:l-1,t.is_write=i?1:n-1,t.is_edit=i?1:r-1,t.is_export=i?1:o-1,t.is_view=i?1:a-1,t.getDebt()}}))},formatNumber:c["k"],getCountOverdueDebt:function(){var t=this;p.countOverdueDebt().then((function(e){t.countOverdueDebt=e.data.count,t.countOverdueDebt>0&&(t.isOverdueDebt=!0)})).catch((function(t){console.log(t)}))},handleChangeDateRange:function(t){var e=new Date(t[0]),i=new Date(t[1]);this.listQuery.page=1,this.listQuery.from_date_payment=e.getTime(),this.listQuery.to_date_payment=i.getTime(),this.getDebt()},checkLinkValidity:function(t){return new Promise((function(e,i){fetch(t,{method:"HEAD"}).then((function(t){t.ok?e("ok"):i("Failed to fetch the URL: ".concat(t.status))})).catch((function(t){i("An error occurred while fetching the URL: ".concat(t))}))}))},confirmDowload:function(t){this.getFileFromServer(t)},getFileFromServer:function(t){var e=this;return Object(l["a"])(Object(r["a"])().mark((function i(){var n,a;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:n=t.substring(t.lastIndexOf("/")+1),a=document.createElement("a"),a.href=t,a.download=n,a.click(),setTimeout((function(){window.URL.revokeObjectURL(t),e.$message.success("Xuất file thành công, vui lòng vào thư mục donwload để xem")}),250);case 6:case"end":return i.stop()}}),i)})))()},handleExportExcel:function(){var t=this;console.log("export excel"),p.exportExcelListDebt(this.listQuery).then((function(e){var i=e.error,n=e.link;0===i?t.confirmDowload(n):t.$message.error("Lỗi khi xuất file excel")})).catch((function(e){console.log(e),t.$message.error("Lỗi khi xuất file excel")}))},getDebt:function(){var t=this;this.is_view&&(this.loading=!0,this.listQuery.q||delete this.listQuery.q,p.listDebt(this.listQuery).then((function(e){console.log(e),1===t.listQuery.page&&(t.total=e.total),t.tableData=e.data,t.tableData.forEach((function(e){e.code="NCC"+e.shop_id,e.state=0===e.status_paid?"Đã quá hạn":"Đúng hạn",e.debt_beginning_format=t.formatNumber(e.debt_beginning)+"đ",e.debt_end_priod_format=t.formatNumber(e.debt_end_priod)+"đ",e.debt_arises_format=t.formatNumber(e.debt_arises)+"đ",e.money_paid_format=t.formatNumber(e.money_paid)+"đ",e.remaining_money_format=t.formatNumber(e.remaining_money)+"đ"}))})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1})),console.log("get list tag"))},resetFilter:function(){this.listQuery={page:1,limit:10,type_search:2,q:""},this.filterState=null,this.dateRangeDebt="",this.getDebt()}}},g=h,m=(i("16dd"),i("2877")),f=Object(m["a"])(g,n,a,!1,null,"78208c2f",null);e["default"]=f.exports},f677:function(t,e,i){}}]);