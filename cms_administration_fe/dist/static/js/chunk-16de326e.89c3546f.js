(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16de326e"],{"6dee":function(e,t,a){"use strict";a.r(t);a("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"debt-page"}},[t("div",{staticStyle:{width:"100",display:"flex","justify-content":"space-between"}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("p",{staticStyle:{"margin-right":"15px","margin-bottom":"0px"},on:{click:e.onBack}},[t("i",{staticClass:"el-icon-back"})]),t("h3",{staticStyle:{margin:"0px"}},[e._v("Bảng kê giao dịch")])]),t("div",{staticStyle:{display:"flex"}},[e.is_export?t("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.handleExportExcel}},[e._v("Xuất excel")]):e._e(),e.is_write?t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAddDialog}},[e._v("Thêm giao dịch")]):e._e(),t("el-button",{staticStyle:{float:"right"},attrs:{icon:"el-icon-refresh",loading:e.loading},on:{click:e.resetFilter}},[e._v("Làm mới")])],1)]),t("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},[t("el-select",{staticStyle:{width:"190px","margin-right":"10px"},attrs:{placeholder:"Nhà cung cấp"},model:{value:e.filterShop,callback:function(t){e.filterShop=t},expression:"filterShop"}},e._l(e.shopOption,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-date-picker",{staticStyle:{width:"450px"},attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"Đến","start-placeholder":"Ngày bắt đầu thanh toán","end-placeholder":"Ngày kết thúc thanh toán"},on:{change:e.handleChangeDateRange},model:{value:e.dateRangeDebt,callback:function(t){e.dateRangeDebt=t},expression:"dateRangeDebt"}}),t("el-date-picker",{staticStyle:{width:"450px","margin-left":"10px"},attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"Đến","start-placeholder":"Ngày bắt đầu tạo","end-placeholder":"Ngày kết thúc tạo"},on:{change:e.handleChangeDateRangeCreate},model:{value:e.dateRangeCreate,callback:function(t){e.dateRangeCreate=t},expression:"dateRangeCreate"}})],1),t("div",{staticStyle:{"margin-top":"20px"},attrs:{id:"brand-table-id"}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,align:"center",border:""}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"code",label:"Mã NCC",width:"120",align:"center"}}),t("el-table-column",{attrs:{prop:"shop_name",label:"Tên nhà cung cấp",align:"center"}}),t("el-table-column",{attrs:{prop:"money_paid_format",label:"Số tiền đã thanh toán",align:"center"}}),t("el-table-column",{attrs:{prop:"date_payment",label:"Ngày thanh toán",align:"center"}}),t("el-table-column",{attrs:{prop:"date_created",label:"Ngày tạo",align:"center"}}),t("el-table-column",{attrs:{prop:"remaining_money_format",label:"Số tiền còn lại",align:"center"}}),t("el-table-column",{attrs:{label:"Hành động",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.is_delete?t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.onDeleteTransaction(a.row)}}}):e._e()]}}])})],1),t("el-row",[t("pagination",{attrs:{total:e.total,limit:e.listQuery.limit,page:e.listQuery.page},on:{"update:limit":function(t){return e.$set(e.listQuery,"limit",t)},"update:page":function(t){return e.$set(e.listQuery,"page",t)},pagination:e.getDebt}})],1)],1),e.showDialogAddTag?t("DialogAddTrade",{attrs:{"show-dialog":e.showDialogAddTag}}):e._e()],1)},i=[],o=a("c7eb"),l=a("1da1"),r=(a("e9c4"),a("ac1f"),a("5319"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("88a7"),a("271a"),a("5494"),a("9911"),a("159b"),a("045c")),s=a("333d"),c=a("bcc2"),d=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.dialog.titleName,visible:e.showDialog,"before-close":e.handleClose,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],ref:"ruleForm",staticClass:"add-trade-ruleForm",attrs:{rules:e.rules,model:e.formRequest}},[t("el-form-item",[t("label",[e._v(e._s("Số tiền thanh toán")),t("span",{staticStyle:{color:"red"}},[e._v("*")])]),t("el-form-item",{attrs:{prop:"money"}},[t("el-input",{attrs:{required:"",maxlength:"20",prop:"money",placeholder:"Số tiền thanh toán"},on:{input:e.handleInput},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSubmitForm("ruleForm")}},model:{value:e.formatMoney,callback:function(t){e.formatMoney=t},expression:"formatMoney"}})],1)],1),t("el-form-item",[t("label",[e._v(e._s("Ngày thanh toán")),t("span",{staticStyle:{color:"red"}},[e._v("*")])]),t("el-form-item",{attrs:{prop:"date_payment_format"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"Chọn ngày thanh toán","value-format":"yyyy-MM-dd"},on:{change:e.handleChangeDate},model:{value:e.formRequest.date_payment_format,callback:function(t){e.$set(e.formRequest,"date_payment_format",t)},expression:"formRequest.date_payment_format"}})],1)],1),t("el-form-item",[t("label",[e._v(e._s("Nhà cung cấp")),t("span",{staticStyle:{color:"red"}},[e._v("*")])]),t("el-form-item",{attrs:{prop:"shop_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"Nhà cung cấp"},model:{value:e.formRequest.shop_id,callback:function(t){e.$set(e.formRequest,"shop_id",t)},expression:"formRequest.shop_id"}},e._l(e.listShop,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-form-item",{attrs:{label:"Chứng từ"}},[t("UploadContract",{ref:"upload-contract",staticStyle:{width:"200px"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("Hủy")]),t("el-button",{attrs:{type:"primary",loading:e.loadingSubmit},on:{click:function(t){return e.onSubmitForm("ruleForm")}}},[e._v(e._s(e.dialog.buttonName))])],1)],1)},h=[],u=(a("00b4"),a("fb6a"),a("d81d"),a("61f7")),p=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"200px"}},[t("el-upload",{staticClass:"upload-demo",staticStyle:{"margin-top":"10px",display:"inline-block"},attrs:{"file-list":e.fileList,action:e.urlBaseApi,name:"image","on-preview":e.handlePreview,"on-success":e.handleUploadSuccess,"on-remove":e.handleRemove,limit:5,"on-exceed":e.handleExceed,"before-upload":e.beforeUpload,accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",multiple:""},scopedSlots:e._u([{key:"tip",fn:function(){return[t("div",{staticClass:"el-upload__tip"},[e._v(" Tải lên file nhỏ hơn 5MB ")])]},proxy:!0}])},[t("el-button",{attrs:{type:"primary"}},[e._v("Tải lên chứng từ")])],1)],1)},f=[],g=(a("14d9"),a("4de4"),a("a27e")),m="https://shop.vcallid.com/api/public",y={name:"UploadContract",props:{showDialog:{type:Boolean,default:!1}},data:function(){return{urlBaseApi:"".concat(m,"/post_cdn"),fileList:[]}},methods:{uploadFile:function(e){Object(g["a"])({url:this.urlBaseApi,method:"post",data:e})},emitListFile:function(){this.$root.$emit("set-image-list",this.fileList),console.log("emit success")},handleUploadSuccess:function(e,t){console.log(e,t,"response"),0===e.error&&(this.fileList.push({url:e.name,name:t.name,uid:t.uid}),this.emitListFile())},handleRemove:function(e){this.fileList=this.fileList.filter((function(t){return t.uid!==e.uid})),this.emitListFile(),console.log(this.fileList,"this.fileList")},handleExceed:function(e,t){this.$message.error("Số file phải ít hơn 5")},handlePreview:function(e){},beforeUpload:function(e){var t=5242880;return!(e.size>t)||(this.$message.error("File phải có dung lượng nhỏ hơn 5 MB."),!1)}}},b=y,_=a("2877"),v=Object(_["a"])(b,p,f,!1,null,"0e2ed549",null),w=v.exports,x=new r["a"],D={name:"DialogAddTrade",components:{UploadContract:w},props:{showDialog:{type:Boolean,default:!1},formRequest:{type:Object,default:function(){return{money:"",date_payment_format:"",shop_id:"",list_files:[]}}}},data:function(){var e=this;return{rules:{money:[{validator:function(t,a,n){return Object(u["q"])(t,e.formRequest.money,n,"Số tiền thanh toán")},trigger:"change"}],date_payment_format:[{validator:function(t,a,n){return Object(u["q"])(t,e.formRequest.date_payment_format,n,"Ngày thanh toán")},trigger:"change"}],shop_id:[{validator:function(t,a,n){return Object(u["q"])(t,e.formRequest.shop_id,n,"Nhà cung cấp")},trigger:"change"}]},dialog:{titleName:"Thêm mới giao dịch",buttonName:"Tạo mới"},dialogLoading:!1,loadingSubmit:!1,formatMoney:"",listShop:[],filterCategory:"",categoryOption:[]}},watch:{formRequest:{handler:function(e){console.log(e,"formRequest")},deep:!0}},created:function(){},mounted:function(){this.getListShop()},methods:{formatNumber:c["k"],validNumber:function(e){var t=/^[0-9]+$/;return t.test(e)},getListShop:function(){var e=this;x.listShop().then((function(t){console.log(t,"response"),e.listShop=t.list}))},handleInput:function(e){if(console.log(e[e.length-1],"value"),e)if(this.validNumber(e[e.length-1])){var t=e.replace(/\./g,"");if(!this.validNumber(t))return this.$message.error("Số tiền thanh toán không hợp lệ");var a=t;if(!isNaN(a)){var n=this.formatNumber(a);this.formRequest.money=a,this.formatMoney=n}}else this.formatMoney=1===e.length?"":e.slice(0,-1)},onSubmitForm:function(e){var t=this;return Object(l["a"])(Object(o["a"])().mark((function a(){return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(l["a"])(Object(o["a"])().mark((function e(a){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a&&t.createNewTrade();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.showDialog=!1,this.$parent.$emit("hide-add-tag-dialog")},createNewTrade:function(){var e=this;this.dialogLoading=!0,this.formRequest.list_files=this.$refs["upload-contract"].fileList.map((function(e){return e.url})),x.updateHistoryTrade(this.formRequest).then((function(t){console.log(t,"responseeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"),e.dialogLoading=!1,e.$message.success("Tạo mới giao dịch thành công"),e.showDialog=!1,e.$parent.$emit("hide-add-tag-dialog"),e.$parent.$emit("refresh-list-tag")})).catch((function(t){console.log(t),e.$message.error("Thêm mới giao dịch thất bại")})).finally((function(){e.dialogLoading=!1}))},handleChangeDate:function(e){var t=new Date(e);this.formRequest.date_payment=t.getTime()}}},S=D,k=(a("f6d99"),Object(_["a"])(S,d,h,!1,null,"3f7d3733",null)),N=k.exports,R=a("5f87"),T=a("fa7d"),C=new r["a"],$={name:"DebtPage",components:{Pagination:s["a"],DialogAddTrade:N},data:function(){return{is_write:0,is_edit:0,is_delete:0,is_view:0,is_export:0,dateRangeDebt:"",dateRangeCreate:"",loading:!1,showDialogAddTag:!1,showDialogEditTag:!1,tableData:[],total:0,listQuery:{page:1,limit:10},filterShop:0,shopOption:[],searchOption:[{id:2,name:"Tìm theo tên nhà cung cấp"},{id:1,name:"Tìm theo mã nhà cung cấp"}]}},watch:{filterShop:{handler:function(){this.listQuery.page=1,this.listQuery.shop_id=this.filterShop,this.getDebt()}}},created:function(){var e=this;this.$on("hide-add-tag-dialog",(function(){e.showDialogAddTag=!1})),this.$on("hide-edit-tag-dialog",(function(){e.showDialogEditTag=!1})),this.$on("refresh-list-tag",(function(){e.getDebt()}))},beforeDestroy:function(){this.$off("hide-add-tag-dialog"),this.$off("hide-edit-tag-dialog")},mounted:function(){console.log("........check o day ",JSON.stringify(this.$router.history.current.meta)),this.getAllShop(),this.requestListPermissionMenu()},methods:{onBack:function(){window.history.back()},requestListPermissionMenu:function(){var e=this,t=this.$router.history.current.meta.roles,a=t&&t.length?t[0]:0;console.log("........check info ",a,t),a=parseInt(a.replace("NCC",""));var n=Object(R["a"])(),i=n.email;Object(T["a"])(i,a,(function(t){if(console.log("............list data 1",JSON.stringify(t)),t){var a=t.is_supper_admin,n=t.is_add,i=t.is_view,o=t.is_edit,l=t.is_delete,r=t.is_export;a=parseInt(a)||0,n=parseInt(n)||1,i=parseInt(i)||1,o=parseInt(o)||1,l=parseInt(l)||1,r=parseInt(r)||1,e.is_delete=a?1:l-1,e.is_write=a?1:n-1,e.is_edit=a?1:o-1,e.is_export=a?1:r-1,e.is_view=a?1:i-1,e.getDebt()}}))},formatNumber:c["k"],getAllShop:function(){var e=this;C.listShop().then((function(t){e.shopOption=[{id:0,name:"Nhà cung cấp(Tất cả)"},t.list]})).catch((function(e){console.log(e)}))},handleChangeDateRange:function(e){var t=new Date(e[0]),a=new Date(e[1]);this.listQuery.page=1,this.listQuery.from_date_payment=t.getTime(),this.listQuery.to_date_payment=a.getTime(),this.getDebt()},handleChangeDateRangeCreate:function(e){var t=new Date(e[0]),a=new Date(e[1]);this.listQuery.page=1,this.listQuery.from_date_create=t.getTime(),this.listQuery.to_date_create=a.getTime(),this.getDebt()},checkLinkValidity:function(e){return new Promise((function(t,a){fetch(e,{method:"HEAD"}).then((function(e){e.ok?t("ok"):a("Failed to fetch the URL: ".concat(e.status))})).catch((function(e){a("An error occurred while fetching the URL: ".concat(e))}))}))},confirmDowload:function(e){this.getFileFromServer(e)},getFileFromServer:function(e){var t=this;return Object(l["a"])(Object(o["a"])().mark((function a(){var n,i;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e.substring(e.lastIndexOf("/")+1),i=document.createElement("a"),i.href=e,i.download=n,i.click(),setTimeout((function(){window.URL.revokeObjectURL(e),t.$message.success("Xuất file thành công, vui lòng vào thư mục donwload để xem")}),250);case 6:case"end":return a.stop()}}),a)})))()},handleExportExcel:function(){var e=this;console.log("export excel"),C.exportExcelListDebtHistory(this.listQuery).then((function(t){var a=t.error,n=t.link;0===a?e.confirmDowload(n):e.$message.error("Lỗi khi xuất file excel")})).catch((function(t){console.log(t),e.$message.error("Lỗi khi xuất file excel")}))},getDebt:function(){var e=this;this.is_view&&(this.loading=!0,this.listQuery.q||delete this.listQuery.q,C.listDebtHistory(this.listQuery).then((function(t){1===e.listQuery.page&&(e.total=t.total),e.tableData=t.data,e.tableData.forEach((function(t,a){t.stt=(e.listQuery.page-1)*e.listQuery.limit+a+1,t.code="NCC"+t.shop_id,t.state=0===t.status_paid?"Chưa thanh toán":"Đã thanh toán",t.debt_beginning_format=e.formatNumber(t.debt_beginning),t.debt_end_priod_format=e.formatNumber(t.debt_end_priod),t.debt_arises_format=e.formatNumber(t.debt_arises),t.money_paid_format=e.formatNumber(t.money_paid)+"đ",t.remaining_amount_format=e.formatNumber(t.remaining_amount)+"đ"}))})).catch((function(e){console.log(e)})).finally((function(){e.loading=!1})))},resetFilter:function(){this.listQuery={page:1,limit:10},this.filterShop=null,this.dateRangeDebt="",this.dateRangeCreate="",this.getDebt()},onDeleteTransaction:function(e){var t=this;this.$confirm("Bạn đang thao tác xóa giao dịch. Bạn có chắc chắn muốn tiếp tục ?","Xác nhận xóa giao dịch?",{confirmButtonText:"Xác nhận",cancelButtonText:"Hủy",type:"warning"}).then((function(){t.handleDeleteTransaction(e.id)})).catch((function(){console.log("cancel")}))},handleDeleteTransaction:function(e){var t=this;C.deleteDebtTransaction({id:e}).then((function(e){t.$message.success("Xóa giao dịch thành công"),t.getDebt()})).catch((function(e){console.log(e),t.$message.error("Xóa giao dịch thất bại")}))},handleAddDialog:function(){this.showDialogAddTag=!0}}},L=$,O=(a("f587"),Object(_["a"])(L,n,i,!1,null,"4d88476a",null));t["default"]=O.exports},"79a9":function(e,t,a){},f3a4:function(e,t,a){},f587:function(e,t,a){"use strict";a("f3a4")},f6d99:function(e,t,a){"use strict";a("79a9")}}]);