(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02e84490"],{1496:function(t,e,a){"use strict";a("fdd6")},afc8:function(t,e,a){},c836:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var i=a("d4ec"),n=a("bee2"),o=a("262e"),l=a("2caf"),s=(a("99af"),a("6c6e")),r=a("a27e"),c="https://shop.vcallid.com/api/public",u=function(t){Object(o["a"])(a,t);var e=Object(l["a"])(a);function a(){return Object(i["a"])(this,a),e.call(this,"")}return Object(n["a"])(a,[{key:"approve_contract",value:function(t){return Object(r["a"])({url:c+"/supplier/approve_contract",method:"post",data:t})}},{key:"list_contact_not_approve",value:function(){return Object(r["a"])({url:c+"/supplier/list_contact_not_approve",method:"get"})}},{key:"contract_change_state",value:function(t){return Object(r["a"])({url:c+"/supplier/contract_change_state",method:"post",data:t})}},{key:"delete_contract",value:function(t){return Object(r["a"])({url:c+"/supplier/delete_contract",method:"post",data:t})}},{key:"statistical_home",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(r["a"])({url:c+"/supplier/statistical_home?shop_id=".concat(t),method:"get"})}},{key:"statistical_supplier_list",value:function(t){return Object(r["a"])({url:c+"/supplier/statistical_supplier_list",method:"get",params:t})}},{key:"statistical_line_chart_week",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(r["a"])({url:c+"/supplier/statistical_line_chart?shop_id=".concat(t,"&chanel=").concat(e),method:"get"})}},{key:"supplier_list_category",value:function(t){return Object(r["a"])({url:c+"/supplier/list_categories_supplier",method:"get",params:t})}},{key:"update_cost",value:function(t){return Object(r["a"])({url:c+"/supplier/update_delivery_cost",method:"post",data:t})}}]),a}(s["a"])},daff:function(t,e,a){"use strict";a("afc8")},e0e2:function(t,e,a){"use strict";a.r(e);a("b0c0");var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"debt-page"}},[t.showInfoDetail?e("RevenueInfo",{attrs:{"object-data":t.objectDetail,"show-detail":t.showInfoDetail,"offset-top":t.currentY},on:{closeDialog:function(e){t.showInfoDetail=!1}}}):t._e(),e("div",{staticStyle:{width:"100",display:"flex","justify-content":"space-between"}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("p",{staticStyle:{"margin-right":"15px","margin-bottom":"0px"},on:{click:t.onBack}},[e("i",{staticClass:"el-icon-back"})]),e("h3",{staticStyle:{margin:"0px"}},[t._v("Quản lý doanh thu đơn hàng")])]),e("div",{staticStyle:{display:"flex"}},[t.is_export?e("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:t.handleExportExcel}},[t._v("Xuất excel")]):t._e(),e("el-button",{staticStyle:{float:"right"},attrs:{icon:"el-icon-refresh",loading:t.loading},on:{click:t.resetFilter}},[t._v("Làm mới")])],1)]),e("div",{staticStyle:{display:"flex","justify-content":"space-between","margin-top":"10px"}},[e("el-select",{staticStyle:{width:"15%"},attrs:{placeholder:"Sale xử lý"},model:{value:t.filterSale,callback:function(e){t.filterSale=e},expression:"filterSale"}},t._l(t.saleOption,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-select",{staticStyle:{width:"19%"},attrs:{placeholder:"Thanh toán"},model:{value:t.filterPaid,callback:function(e){t.filterPaid=e},expression:"filterPaid"}},t._l(t.paidOption,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-date-picker",{staticStyle:{width:"28%"},attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"Đến","start-placeholder":"Ngày tạo","end-placeholder":"Ngày tạo"},on:{change:t.handleChangeDateRangeCreate},model:{value:t.dateRangeCreate,callback:function(e){t.dateRangeCreate=e},expression:"dateRangeCreate"}}),e("el-date-picker",{staticStyle:{width:"35%"},attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"Đến","start-placeholder":"Ngày tính doanh thu","end-placeholder":"Ngày tính doanh thu"},on:{change:t.handleChangeDateRange},model:{value:t.dateRangeDebt,callback:function(e){t.dateRangeDebt=e},expression:"dateRangeDebt"}})],1),e("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{type:"text",rows:2,placeholder:"Nhập mã đơn hàng để tìm kiếm"},model:{value:t.searchRevenue,callback:function(e){t.searchRevenue=e},expression:"searchRevenue"}},[e("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearchRevenue}},[t._v("Tìm kiếm")]),e("el-button",{staticStyle:{"margin-left":"10px"},on:{click:t.onClearSearchPress}},[t._v("Xóa tìm kiếm")]),e("el-select",{staticStyle:{width:"180px","margin-left":"10px"},attrs:{placeholder:"Trạng thái đơn"},model:{value:t.filterState,callback:function(e){t.filterState=e},expression:"filterState"}},t._l(t.stateOption,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),e("el-select",{staticStyle:{width:"180px","margin-left":"10px"},attrs:{placeholder:"Nguồn"},model:{value:t.filterSource,callback:function(e){t.filterSource=e},expression:"filterSource"}},t._l(t.sourceOption,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("div",{staticStyle:{"margin-top":"10px"},attrs:{id:"brand-table-id"}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,align:"center",border:""}},[e("el-table-column",{attrs:{prop:"code",label:"Mã đơn",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-link",{staticStyle:{color:"#4CA1D5"},attrs:{underline:!1},on:{click:function(e){return t.handleDialogInfo(a.row)}}},[t._v(t._s(a.row.code))])]}}])}),e("el-table-column",{attrs:{label:"Mã voucher",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-link",{staticStyle:{color:"#4CA1D5"},attrs:{underline:!1},on:{click:function(e){return t.handleDialogVoucher(a.row)}}},[t._v(t._s(a.row.voucher_code))])]}}])}),e("el-table-column",{attrs:{prop:"customerName",label:"Khách hàng",align:"center"}}),e("el-table-column",{attrs:{prop:"revenueFormat",label:"Doanh thu",align:"center"}}),e("el-table-column",{attrs:{prop:"totalCostFormat",label:"Tổng giá nhập",align:"center"}}),e("el-table-column",{attrs:{label:"Tổng hoàn point",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.isNumber(a.row.point_refund)?e("p",[t._v(t._s(t.formatNumber(a.row.point_refund)))]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"profitFormat",label:"Lợi nhuận",align:"center"}}),e("el-table-column",{attrs:{prop:"paid",label:"Thanh toán",align:"center",width:"140"},scopedSlots:t._u([{key:"default",fn:function(a){return[1==a.row.state_payment?e("p",{staticStyle:{color:"#0C8C56","font-size":"14px"}},[t._v(t._s(a.row.name_payment))]):t._e(),0==a.row.state_payment?e("p",{staticStyle:{color:"red","font-size":"14px"}},[t._v(t._s(a.row.name_payment))]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"saleName",label:"Sale xử lý",align:"center"}}),e("el-table-column",{attrs:{prop:"secretaryName",label:"Thư ký",align:"center"}}),e("el-table-column",{attrs:{prop:"date_complete",label:"Ngày tính doanh thu",align:"center"}}),e("el-table-column",{attrs:{prop:"name_state_delivery",label:"Trạng thái đơn",align:"center"}}),e("el-table-column",{attrs:{prop:"createdAt",label:"Ngày tạo đơn",align:"center"}}),e("el-table-column",{attrs:{prop:"name_source",label:"Nguồn",align:"center"}})],1),e("el-row",[e("pagination",{attrs:{total:t.total,limit:t.listQuery.limit,page:t.listQuery.page},on:{"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},"update:page":function(e){return t.$set(t.listQuery,"page",e)},pagination:t.getRevenue}})],1)],1),t.showDialogVoucher?e("DialogVoucher",{attrs:{"data-object":t.voucherObject,"show-detail":t.showDialogVoucher},on:{closeDialog:function(e){t.showDialogVoucher=!1}}}):t._e()],1)},n=[],o=a("c7eb"),l=a("1da1"),s=a("2909"),r=(a("ac1f"),a("5319"),a("e9c4"),a("99af"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("88a7"),a("271a"),a("5494"),a("9911"),a("159b"),a("0d87")),c=a("333d"),u=a("bcc2"),h=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"dialog-show-info",staticStyle:{right:"0px"},style:{top:t.offsetTop+"px"},attrs:{visible:t.showDetail,width:"100%","before-close":t.handleClose,"close-on-click-modal":!1},on:{"update:visible":function(e){t.showDetail=e}}},[e("h3",{staticStyle:{color:"black"}},[t._v("Thông tin doanh thu đơn hàng")]),e("hr"),e("h4",{staticStyle:{color:"blueviolet"}},[t._v("Thông tin chung")]),e("div",{staticStyle:{display:"flex","flex-direction":"row","justify-content":"space-between","margin-top":"10px"}},[e("div",{staticClass:"flex-item-dialog"},[e("h6",{staticClass:"font-lable"},[t._v("Mã đơn: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.code))])]),e("h6",{staticClass:"font-lable"},[t._v("Nguồn: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.name_source))])]),e("h6",{staticClass:"font-lable"},[t._v("Người thanh toán: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.customerName))])]),e("h6",{staticClass:"font-lable"},[t._v("Trạng thái: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.name_state_delivery))])])]),e("div",{staticClass:"flex-item-dialog"},[e("h6",{staticClass:"font-lable"},[t._v("Doanh thu: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.revenueFormat))])]),e("h6",{staticClass:"font-lable"},[t._v("Tổng giá nhập: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.totalCostFormat))])]),e("h6",{staticClass:"font-lable"},[t._v("Tổng hoàn point: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.totalPointFormat))])]),e("h6",{staticClass:"font-lable"},[t._v("Mã voucher: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.voucher_code))])])]),e("div",{staticClass:"flex-item-dialog"},[e("h6",{staticClass:"font-lable"},[t._v("Lợi nhuận: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.profitFormat))])]),e("h6",{staticClass:"font-lable"},[t._v("Giá vận chuyển: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.cod_price))])]),e("h6",{staticClass:"font-lable"},[t._v("Thanh toán: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.name_payment))])])]),e("div",{staticStyle:{width:"25%"}},[e("h6",{staticClass:"font-lable"},[t._v("Sale xử lý: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.saleName))])]),e("h6",{staticClass:"font-lable"},[t._v("Ngày tạo đơn: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.createdAt))])]),e("h6",{staticClass:"font-lable"},[t._v("Ngày tính doanh thu: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.date_complete))])])])]),e("h6",{staticClass:"font-lable"},[t._v("Ghi chú: "),e("span",{staticClass:"font-value"},[t._v(t._s(t.objectData.shop_noted))])]),e("hr"),e("h4",{staticStyle:{color:"blueviolet"}},[t._v("Chi tiết đơn hàng")]),e("div",{staticStyle:{"margin-top":"20px"},attrs:{id:"brand-table-id"}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,align:"center",border:""}},[e("el-table-column",{attrs:{prop:"code",label:"Mã SP",align:"center",width:"80px"}}),e("el-table-column",{attrs:{prop:"logo",label:"Logo",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("img",{staticStyle:{width:"100px"},attrs:{src:a.row.logo?a.row.logo:""},on:{error:function(e){return t.handleImageError(a.row)}}})]}}])}),e("el-table-column",{attrs:{prop:"name",label:"Tên sản phẩm",align:"center"}}),e("el-table-column",{attrs:{prop:"category_name",label:"Hạng mục",align:"center"}}),e("el-table-column",{attrs:{prop:"number",label:"Số lượng",align:"center",width:"90px"}}),e("el-table-column",{attrs:{prop:"size",label:"Thuộc tính 1",align:"center"}}),e("el-table-column",{attrs:{prop:"color",label:"Thuộc tính 2",align:"center"}}),e("el-table-column",{attrs:{prop:"priceFormat",label:"Giá niêm yết",align:"center"}}),e("el-table-column",{attrs:{prop:"priceSaleFormat",label:"Giá bán",align:"center"}}),e("el-table-column",{attrs:{label:"Giá nhập",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.isEditing?e("div",[e("el-input",{attrs:{size:"small"},model:{value:a.row.editingCost,callback:function(e){t.$set(a.row,"editingCost",e)},expression:"scope.row.editingCost"}}),e("el-button",{attrs:{type:"text",icon:"el-icon-check"},on:{click:function(e){return t.saveEdit(a.row)}}}),e("el-button",{attrs:{type:"text",icon:"el-icon-close"},on:{click:function(e){return t.cancelEdit(a.row)}}})],1):e("div",[t._v(" "+t._s(a.row.costFormat)+" "),t.is_delete||t.is_edit?e("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.startEdit(a.row)}}}):t._e()],1)]}}])}),e("el-table-column",{attrs:{prop:"supplierName",label:"Nhà cung cấp",align:"center"}})],1),e("el-row",[e("pagination",{attrs:{total:t.total,limit:t.listQuery.limit,page:t.listQuery.page},on:{"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},"update:page":function(e){return t.$set(t.listQuery,"page",e)},pagination:t.getListOrder}})],1)],1)])},d=[],p=(a("a9e3"),a("c836")),f=a("5f87"),g=a("fa7d"),m=new r["a"],v=new p["a"],b={name:"DialogShowInfo",components:{Pagination:c["a"]},props:{objectData:{type:Object,default:function(){return{}}},showDetail:{type:Boolean,default:!1},offsetTop:{type:Number,default:0}},data:function(){return{is_delete:0,is_write:0,is_edit:0,is_export:0,is_view:0,dialog:{titleName:"Thông tin doanh thu đơn hàng"},tableData:[],loading:!1,listQuery:{page:1,limit:10},total:0,note:"Các khoản công nợ được cập nhật kịp thời vào sổ chi tiết ngay khi phát sinh; Cuối tháng, kế toán công nợ sẽ tổng hợp lại để tính tổng công nợ với từng khách hàng, nhà cung cấp, sau đó đối chiếu số liệu 2 bên."}},mounted:function(){this.listQuery.delivery_bill_id=this.objectData.id,this.getListOrder(),console.log("objectData",this.objectData),this.requestListPermissionMenu()},methods:{requestListPermissionMenu:function(){var t=this,e=this.$router.history.current.meta.roles,a=e&&e.length?e[0]:0;a=parseInt(a.replace("NCC",""));var i=Object(f["a"])(),n=i.email;Object(g["a"])(n,a,(function(e){if(console.log("............list data 1",JSON.stringify(e)),e){var a=e.is_supper_admin,i=e.is_add,n=e.is_view,o=e.is_edit,l=e.is_delete,s=e.is_export;a=parseInt(a)||0,i=parseInt(i)||1,n=parseInt(n)||1,o=parseInt(o)||1,l=parseInt(l)||1,s=parseInt(s)||1,t.is_delete=a?1:l-1,t.is_write=a?1:i-1,t.is_edit=a?1:o-1,t.is_export=a?1:s-1,t.is_view=a?1:n-1,t.getRevenue()}}))},formatNumber:u["k"],startEdit:function(t){this.$set(t,"isEditing",!0),this.$set(t,"editingCost",t.cost)},saveEdit:function(t){var e=this,a={delivery_id:t.delivery_id,product_id:t.id_product,cost:t.editingCost};v.update_cost(a).then((function(a){0===a.error?(e.$set(t,"costFormat",e.formatNumber(t.editingCost)+"đ"),e.$set(t,"isEditing",!1),e.$message.success("Cập nhật giá nhập thành công"),e.getListOrder()):e.$message.error(a.msg)})).catch((function(t){console.error("Lỗi khi cập nhật giá nhập",t),e.$message.error("Lỗi khi cập nhật giá nhập")}))},cancelEdit:function(t){this.$set(t,"isEditing",!1)},handleClose:function(){this.$emit("closeDialog")},handleImageError:function(t){t.showImage=!1},getListOrder:function(){var t=this;this.loading=!0,m.listOrder(this.listQuery).then((function(e){console.log(e,"ưqewqewqewqewqeqwewqewq"),1===t.listQuery.page&&(t.total=e.total),t.tableData=e.list,t.tableData.forEach((function(e,a){e.stt=(t.listQuery.page-1)*t.listQuery.limit+a+1,e.code=e.product.product_code,e.logo=e.product.thumb,e.size=e.size?e.size.replace("null",""):"",e.color=e.color?e.color.replace("null",""):"",e.priceFormat=t.formatNumber(e.price)+"đ",e.priceSaleFormat=t.formatNumber(e.price_sale)+"đ",e.costFormat=t.formatNumber(e.cost)+"đ",e.profit=t.formatNumber(e.profit)+"đ",e.supplierName=e.product.shop.name,e.category_name=e.product.category?e.product.category.name:"",e.delivery_id=e.delivery_bill_id,e.id_product=e.product.id,e.input_cost=e.cost}))})).catch((function(e){console.log(e),t.$message.error("Lỗi khi lấy dữ liệu đơn hàng")})).finally((function(){t.loading=!1}))}}},_=b,y=(a("1496"),a("2877")),w=Object(y["a"])(_,h,d,!1,null,"fff6e5b2",null),S=w.exports,x=(a("a4d3"),a("e01a"),function(){var t,e,a,i,n=this,o=n._self._c;return o("el-dialog",{attrs:{title:n.dialog.titleName,visible:n.showDetail,"before-close":n.handleClose,width:"70%"},on:{"update:visible":function(t){n.showDetail=t}}},[o("div",{staticStyle:{display:"flex","flex-direction":"row","justify-content":"start"}},[o("div",{staticStyle:{border:"1px solid gainsboro","border-radius":"12px",padding:"20px",width:"500px"}},[o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Mã voucher: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.dataObject.voucher_code))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Tên voucher: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.voucherObject.name))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Giới hạn tối đa: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.voucherObject.limit_max>0?n.voucherObject.limit_max:"Không giới hạn"))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Ngày áp dụng: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.voucherObject.from_date))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Số lần sử dụng cho khách: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.voucherObject.count_use_per_golfer))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Mô tả: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.voucherObject.description))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Số lần sử dụng cả chương trình: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(n.voucherObject.max_use))])])]),o("div",{staticStyle:{"margin-left":"15px",border:"1px solid gainsboro","border-radius":"12px",padding:"20px",width:"400px"}},[o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Loại voucher: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(null===(t=n.voucherObject.types)||void 0===t?void 0:t.desc))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Loại mã: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s(null===(e=n.voucherObject.types)||void 0===e?void 0:e.name))])]),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Trạng thái: "),o("el-tag",{attrs:{type:null!==(a=n.voucherObject.types)&&void 0!==a&&a.active?"success":"danger"}},[n._v(n._s(null!==(i=n.voucherObject.types)&&void 0!==i&&i.active?"Hoạt động":"Ngừng hoạt động"))])],1),o("h6",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"black"}},[n._v("Giá trị: "),o("span",{staticStyle:{"font-size":"medium","font-weight":"400"}},[n._v(n._s("".concat(n.voucherObject.value).concat(n.voucherObject.types.don_vi_tinh)))])])])])])}),k=[],D=new r["a"],C={name:"DialogVoucher",props:{showDetail:{type:Boolean,default:!1},dataObject:{type:Object,default:function(){return{}}}},data:function(){return{voucherObject:{},dialog:{titleName:"Chi tiết voucher"}}},mounted:function(){var t=this;D.voucherDetail({id:this.dataObject.discount_id}).then((function(e){var a=e.error,i=e.data;console.log("..........voucher detail ",JSON.stringify(i)),0===a&&(t.voucherObject=i)}))},methods:{handleClose:function(){this.$emit("closeDialog")}}},j=C,O=Object(y["a"])(j,x,k,!1,null,null,null),N=O.exports,R=new r["a"],Q={name:"RevenuePage",components:{Pagination:c["a"],RevenueInfo:S,DialogVoucher:N},data:function(){return{is_add:0,is_edit:0,is_delete:0,is_view:0,is_export:0,currentY:0,showDialogVoucher:!1,showInfoDetail:!1,dateRangeDebt:"",dateRangeCreate:"",loading:!1,showDialogAddTag:!1,showDialogEditTag:!1,objectDetail:{},voucherObject:{},tableData:[],total:0,listQuery:{page:1,limit:10,source:0,type_search:1},filterShop:0,shopOption:[],filterSale:0,saleOption:[],filterState:0,stateOption:[{id:0,name:"Trạng thái (Tất cả)"},{id:1,name:"Đã xác nhận bán"},{id:3,name:"Đã giao"}],filterSource:0,sourceOption:[{id:0,name:"Nguồn (Tất cả)"},{id:1,name:"App Wghn"},{id:2,name:"Đơn offline từ cms"},{id:3,name:"Đơn từ cms"},{id:4,name:"Wap/web đối tác(bank)"},{id:5,name:"Wap/web shop"},{id:7,name:"Bill tổng"}],filterPaid:0,paidOption:[{id:0,name:"Thanh toán (Tất cả)"},{id:2,name:"Đã thanh toán"},{id:1,name:"Chưa thanh toán"}],searchRevenue:""}},watch:{filterShop:{handler:function(){this.listQuery.page=1,this.listQuery.shop_id=this.filterShop,this.getRevenue()}},filterSource:{handler:function(){this.listQuery.page=1,this.listQuery.source=this.filterSource,this.getRevenue()}},filterPaid:{handler:function(){this.listQuery.page=1,this.listQuery.paid=this.filterPaid,this.getRevenue()}},filterSale:{handler:function(){this.listQuery.page=1,this.listQuery.account_id=this.filterSale,this.getRevenue()}},filterState:{handler:function(){this.listQuery.page=1,this.listQuery.state=this.filterState,this.getRevenue()}},searchRevenue:{handler:function(){this.listQuery.q=this.searchRevenue}}},created:function(){var t=this;this.$on("hide-add-tag-dialog",(function(){t.showDialogAddTag=!1})),this.$on("hide-edit-tag-dialog",(function(){t.showDialogEditTag=!1})),this.$on("refresh-list-tag",(function(){t.getRevenue()}))},beforeDestroy:function(){this.$off("hide-add-tag-dialog"),this.$off("hide-edit-tag-dialog"),window.removeEventListener("scroll",this.getCurrentY)},mounted:function(){window.addEventListener("scroll",this.getCurrentY),this.getAllSale(),this.requestListPermissionMenu()},methods:{onBack:function(){window.history.back()},requestListPermissionMenu:function(){var t=this,e=this.$router.history.current.meta.roles,a=e&&e.length?e[0]:0;a=parseInt(a.replace("NCC",""));var i=Object(f["a"])(),n=i.email;Object(g["a"])(n,a,(function(e){if(console.log("............list data 1",JSON.stringify(e)),e){var a=e.is_supper_admin,i=e.is_add,n=e.is_view,o=e.is_edit,l=e.is_delete,s=e.is_export;a=parseInt(a)||0,i=parseInt(i)||1,n=parseInt(n)||1,o=parseInt(o)||1,l=parseInt(l)||1,s=parseInt(s)||1,t.is_delete=a?1:l-1,t.is_write=a?1:i-1,t.is_edit=a?1:o-1,t.is_export=a?1:s-1,t.is_view=a?1:n-1,t.getRevenue()}}))},formatNumber:u["k"],getCurrentY:function(){this.currentY=window.scrollY},isNumber:function(t){return"number"===typeof t&&!isNaN(t)},getAllSale:function(){var t=this;R.listSale().then((function(e){t.saleOption=[{id:0,name:"Sale xử lý(Tất cả)"}].concat(Object(s["a"])(e.data))})).catch((function(t){console.log(t)}))},handleChangeDateRange:function(t){var e=new Date(t[0]),a=new Date(t[1]);this.listQuery.page=1,this.listQuery.from_date_payment=e.getTime(),this.listQuery.to_date_payment=a.getTime(),this.getRevenue()},handleChangeDateRangeCreate:function(t){var e=new Date(t[0]),a=new Date(t[1]);this.listQuery.page=1,this.listQuery.from_date_create=e.getTime(),this.listQuery.to_date_create=a.getTime(),this.getRevenue()},confirmDowload:function(t){this.getFileFromServer(t)},getFileFromServer:function(t){var e=this;return Object(l["a"])(Object(o["a"])().mark((function a(){var i,n;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:i=t.substring(t.lastIndexOf("/")+1),n=document.createElement("a"),n.href=t,n.download=i,n.click(),setTimeout((function(){window.URL.revokeObjectURL(t),e.$message.success("Xuất file thành công, vui lòng vào thư mục donwload để xem")}),250);case 6:case"end":return a.stop()}}),a)})))()},handleExportExcel:function(){var t=this;console.log("export excel"),R.exportExcelRevenue(this.listQuery).then((function(e){var a=e.error,i=e.link;0===a?t.confirmDowload(i):t.$message.error("Lỗi khi xuất file excel")})).catch((function(e){console.log(e),t.$message.error("Lỗi khi xuất file excel")}))},onClearSearchPress:function(){this.listQuery.q="",this.searchRevenue="",this.getRevenue()},handleSearchRevenue:function(){this.listQuery.page=1,this.getRevenue()},getRevenue:function(){var t=this;this.is_view&&(this.loading=!0,this.listQuery.q||delete this.listQuery.q,R.listRevenue(this.listQuery).then((function(e){1===t.listQuery.page&&(t.total=e.total),t.tableData=e.data,t.tableData.forEach((function(e,a){console.log("..........check item : ",JSON.stringify(e)),e.stt=(t.listQuery.page-1)*t.listQuery.limit+a+1,e.isPaid="Đã thanh toán"===e.name_payment,e.code="DL"+e.id,e.customerName=e.golfer?e.golfer.name:"",e.revenueFormat=t.formatNumber(e.revenue)+"đ",e.profitFormat=t.formatNumber(e.profit)+"đ",e.totalCostFormat=t.formatNumber(e.total_cost)+"đ",e.totalPointFormat=e.point_refund?t.formatNumber(e.point_refund):"",e.saleName=e.sale?e.sale.name:null,e.secretaryName=e.thuky_info?e.thuky_info.name:null}))})).catch((function(e){console.log(e),t.$message.error("Lỗi khi lấy dữ liệu đơn hàng")})).finally((function(){t.loading=!1})))},resetFilter:function(){this.listQuery={page:1,limit:10,type_search:1},this.filterShop=0,this.dateRangeDebt="",this.dateRangeCreate="",this.filterSale=0,this.filterSource=0,this.filterPaid=0,this.listQuery.q="",this.searchRevenue="",this.getRevenue()},handleDialogInfo:function(t){this.showInfoDetail=!0,this.objectDetail=t},handleDialogVoucher:function(t){this.showDialogVoucher=!0,this.voucherObject=t}}},T=Q,z=(a("daff"),Object(y["a"])(T,i,n,!1,null,"11fdfdb8",null));e["default"]=z.exports},fdd6:function(t,e,a){}}]);